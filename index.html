<!DOCTYPE html>
<html>
<head>
    <title>Math Problem Solver</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Math Problem Solver</h1>
		
		<!-- Login button to open the pop-up -->
        <button onclick="openLoginPopup()" id="login-btn" style="display:inline-block;">Login</button>
		<button type="button" onclick="logout()" id="logout-btn" style="display:none;">Logout</button>
		
        <!-- Math Problem Solver Section -->
        <div id="math-solver" style="display:none;">
			<form id="problem-form">
				<label for="problem-input">Enter your math problem:</label><br>
				<input type="text" id="problem-input" name="problemInput"><br><br>
				<button type="button" onclick="submitProblem()">Solve</button>
				<button type="button" onclick="testServer()">Test</button>
			</form>
			<div id="result"></div>
        <div id="status"></div>
    </div>
	
	<!-- Login pop-up -->
    <div id="login-popup" class="login-popup">
        <h2>Login</h2>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" class="username-input" required><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>

        <button type="button" onclick="login()">Login</button>
        <button type="button" onclick="closeLoginPopup()">Close</button>
    </div>

    <script>
		function openLoginPopup() {
            document.getElementById('login-popup').style.display = 'block';
        }

        function closeLoginPopup() {
            document.getElementById('login-popup').style.display = 'none';
        }
		
		let isLoggedIn = false;
	
		function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            
            // Send credentials to the server for validation
            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Login successful') {
					// Successful login
					isLoggedIn = true;
					// Successful login, close the popup
					document.getElementById('login-popup').style.display = 'none';
					// Successful login, show the math solver section
					document.getElementById('math-solver').style.display = 'block';
					document.getElementById('problem-input').disabled = false;
					// Show the Logout button
					document.getElementById('logout-btn').style.display = 'inline-block';
					// Hide the Login button
					document.getElementById('login-btn').style.display = 'none';
				} else {
					alert('Invalid username or password');
				}
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during login');
            });
        }
		
		function logout() {
			// Log out the user
			isLoggedIn = false;
			// Hide the math solver section
			document.getElementById('math-solver').style.display = 'none';
			// Hide the Logout button
			document.getElementById('logout-btn').style.display = 'none';
			// Clear the problem input
			document.getElementById('problem-input').value = '';
			// Show the login popup
			document.getElementById('login-popup').style.display = 'block';
			// Show the Login button
			document.getElementById('login-btn').style.display = 'inline-block';
		}
	
        function submitProblem() {
            const input = document.getElementById('problem-input').value;
            const result = document.getElementById('result');
            const status = document.getElementById('status');

            const prompt = `Solve the following math problem: ${input}`;

            // Display 'Calculation in progress' message
            status.innerHTML = 'Calculation in progress...';

            fetch('/solve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ problem: prompt }),
            })
            .then(response => response.json())
            .then(data => {
                // Display the result
                result.innerHTML = `Solution: ${data.solution}`;
                // Clear the 'Calculation in progress' message
                status.innerHTML = '';
            })
            .catch(error => {
                console.error('Error:', error);
                result.innerHTML = 'An error occurred. Please try again.';
                // Clear the 'Calculation in progress' message
                status.innerHTML = '';
            });
        }

        function testServer() {
            const result = document.getElementById('result');
            const status = document.getElementById('status');

            // Display 'Testing server' message
            status.innerHTML = 'Testing server...';

            fetch('/test')
                .then(response => response.json())
                .then(data => {
                    console.log(data); // This should log the actual object received from the server
                    // Clear the 'Testing server' message
                    status.innerHTML = '';
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Clear the 'Testing server' message
                    status.innerHTML = '';
                });
        }
    </script>
</body>
</html>
